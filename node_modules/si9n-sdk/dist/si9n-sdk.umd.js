!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("eventemitter3"),require("blueimp-md5"),require("luxon"),require("rrule")):"function"==typeof define&&define.amd?define(["eventemitter3","blueimp-md5","luxon","rrule"],e):"object"==typeof exports?exports.si9n=e(require("eventemitter3"),require("blueimp-md5"),require("luxon"),require("rrule")):t.si9n=e(t.eventemitter3,t["blueimp-md5"],t.luxon,t.rrule)}(self,((t,e,r,i)=>(()=>{"use strict";var s={9662:(t,e,r)=>{var i=r(614),s=r(6330),n=TypeError;t.exports=function(t){if(i(t))return t;throw n(s(t)+" is not a function")}},9670:(t,e,r)=>{var i=r(111),s=String,n=TypeError;t.exports=function(t){if(i(t))return t;throw n(s(t)+" is not an object")}},1318:(t,e,r)=>{var i=r(5656),s=r(1400),n=r(6244),a=function(t){return function(e,r,a){var o,u=i(e),h=n(u),c=s(a,h);if(t&&r!=r){for(;h>c;)if((o=u[c++])!=o)return!0}else for(;h>c;c++)if((t||c in u)&&u[c]===r)return t||c||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},3658:(t,e,r)=>{var i=r(9781),s=r(3157),n=TypeError,a=Object.getOwnPropertyDescriptor,o=i&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=o?function(t,e){if(s(t)&&!a(t,"length").writable)throw n("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},4326:(t,e,r)=>{var i=r(1702),s=i({}.toString),n=i("".slice);t.exports=function(t){return n(s(t),8,-1)}},648:(t,e,r)=>{var i=r(1694),s=r(614),n=r(4326),a=r(5112)("toStringTag"),o=Object,u="Arguments"===n(function(){return arguments}());t.exports=i?n:function(t){var e,r,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=o(t),a))?r:u?n(e):"Object"===(i=n(e))&&s(e.callee)?"Arguments":i}},9920:(t,e,r)=>{var i=r(2597),s=r(3887),n=r(1236),a=r(3070);t.exports=function(t,e,r){for(var o=s(e),u=a.f,h=n.f,c=0;c<o.length;c++){var l=o[c];i(t,l)||r&&i(r,l)||u(t,l,h(e,l))}}},8880:(t,e,r)=>{var i=r(9781),s=r(3070),n=r(9114);t.exports=i?function(t,e,r){return s.f(t,e,n(1,r))}:function(t,e,r){return t[e]=r,t}},9114:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},7045:(t,e,r)=>{var i=r(6339),s=r(3070);t.exports=function(t,e,r){return r.get&&i(r.get,e,{getter:!0}),r.set&&i(r.set,e,{setter:!0}),s.f(t,e,r)}},8052:(t,e,r)=>{var i=r(614),s=r(3070),n=r(6339),a=r(3072);t.exports=function(t,e,r,o){o||(o={});var u=o.enumerable,h=void 0!==o.name?o.name:e;if(i(r)&&n(r,h,o),o.global)u?t[e]=r:a(e,r);else{try{o.unsafe?t[e]&&(u=!0):delete t[e]}catch(t){}u?t[e]=r:s.f(t,e,{value:r,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return t}},3072:(t,e,r)=>{var i=r(7854),s=Object.defineProperty;t.exports=function(t,e){try{s(i,t,{value:e,configurable:!0,writable:!0})}catch(r){i[t]=e}return e}},9781:(t,e,r)=>{var i=r(7293);t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:t=>{var e="object"==typeof document&&document.all,r=void 0===e&&void 0!==e;t.exports={all:e,IS_HTMLDDA:r}},317:(t,e,r)=>{var i=r(7854),s=r(111),n=i.document,a=s(n)&&s(n.createElement);t.exports=function(t){return a?n.createElement(t):{}}},7207:t=>{var e=TypeError;t.exports=function(t){if(t>9007199254740991)throw e("Maximum allowed index exceeded");return t}},8113:t=>{t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7392:(t,e,r)=>{var i,s,n=r(7854),a=r(8113),o=n.process,u=n.Deno,h=o&&o.versions||u&&u.version,c=h&&h.v8;c&&(s=(i=c.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!s&&a&&(!(i=a.match(/Edge\/(\d+)/))||i[1]>=74)&&(i=a.match(/Chrome\/(\d+)/))&&(s=+i[1]),t.exports=s},748:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:(t,e,r)=>{var i=r(7854),s=r(1236).f,n=r(8880),a=r(8052),o=r(3072),u=r(9920),h=r(4705);t.exports=function(t,e){var r,c,l,d,p,f=t.target,m=t.global,y=t.stat;if(r=m?i:y?i[f]||o(f,{}):(i[f]||{}).prototype)for(c in e){if(d=e[c],l=t.dontCallGetSet?(p=s(r,c))&&p.value:r[c],!h(m?c:f+(y?".":"#")+c,t.forced)&&void 0!==l){if(typeof d==typeof l)continue;u(d,l)}(t.sham||l&&l.sham)&&n(d,"sham",!0),a(r,c,d,t)}}},7293:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},4374:(t,e,r)=>{var i=r(7293);t.exports=!i((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},6916:(t,e,r)=>{var i=r(4374),s=Function.prototype.call;t.exports=i?s.bind(s):function(){return s.apply(s,arguments)}},6530:(t,e,r)=>{var i=r(9781),s=r(2597),n=Function.prototype,a=i&&Object.getOwnPropertyDescriptor,o=s(n,"name"),u=o&&"something"===function(){}.name,h=o&&(!i||i&&a(n,"name").configurable);t.exports={EXISTS:o,PROPER:u,CONFIGURABLE:h}},1702:(t,e,r)=>{var i=r(4374),s=Function.prototype,n=s.call,a=i&&s.bind.bind(n,n);t.exports=i?a:function(t){return function(){return n.apply(t,arguments)}}},5005:(t,e,r)=>{var i=r(7854),s=r(614);t.exports=function(t,e){return arguments.length<2?(r=i[t],s(r)?r:void 0):i[t]&&i[t][e];var r}},8173:(t,e,r)=>{var i=r(9662),s=r(8554);t.exports=function(t,e){var r=t[e];return s(r)?void 0:i(r)}},7854:function(t,e,r){var i=function(t){return t&&t.Math===Math&&t};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof r.g&&r.g)||function(){return this}()||this||Function("return this")()},2597:(t,e,r)=>{var i=r(1702),s=r(7908),n=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return n(s(t),e)}},3501:t=>{t.exports={}},4664:(t,e,r)=>{var i=r(9781),s=r(7293),n=r(317);t.exports=!i&&!s((function(){return 7!==Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},8361:(t,e,r)=>{var i=r(1702),s=r(7293),n=r(4326),a=Object,o=i("".split);t.exports=s((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"===n(t)?o(t,""):a(t)}:a},2788:(t,e,r)=>{var i=r(1702),s=r(614),n=r(5465),a=i(Function.toString);s(n.inspectSource)||(n.inspectSource=function(t){return a(t)}),t.exports=n.inspectSource},9909:(t,e,r)=>{var i,s,n,a=r(4811),o=r(7854),u=r(111),h=r(8880),c=r(2597),l=r(5465),d=r(6200),p=r(3501),f="Object already initialized",m=o.TypeError,y=o.WeakMap;if(a||l.state){var g=l.state||(l.state=new y);g.get=g.get,g.has=g.has,g.set=g.set,i=function(t,e){if(g.has(t))throw m(f);return e.facade=t,g.set(t,e),e},s=function(t){return g.get(t)||{}},n=function(t){return g.has(t)}}else{var v=d("state");p[v]=!0,i=function(t,e){if(c(t,v))throw m(f);return e.facade=t,h(t,v,e),e},s=function(t){return c(t,v)?t[v]:{}},n=function(t){return c(t,v)}}t.exports={set:i,get:s,has:n,enforce:function(t){return n(t)?s(t):i(t,{})},getterFor:function(t){return function(e){var r;if(!u(e)||(r=s(e)).type!==t)throw m("Incompatible receiver, "+t+" required");return r}}}},3157:(t,e,r)=>{var i=r(4326);t.exports=Array.isArray||function(t){return"Array"===i(t)}},614:(t,e,r)=>{var i=r(4154),s=i.all;t.exports=i.IS_HTMLDDA?function(t){return"function"==typeof t||t===s}:function(t){return"function"==typeof t}},4705:(t,e,r)=>{var i=r(7293),s=r(614),n=/#|\.prototype\./,a=function(t,e){var r=u[o(t)];return r===c||r!==h&&(s(e)?i(e):!!e)},o=a.normalize=function(t){return String(t).replace(n,".").toLowerCase()},u=a.data={},h=a.NATIVE="N",c=a.POLYFILL="P";t.exports=a},8554:t=>{t.exports=function(t){return null==t}},111:(t,e,r)=>{var i=r(614),s=r(4154),n=s.all;t.exports=s.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:i(t)||t===n}:function(t){return"object"==typeof t?null!==t:i(t)}},1913:t=>{t.exports=!1},2190:(t,e,r)=>{var i=r(5005),s=r(614),n=r(7976),a=r(3307),o=Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=i("Symbol");return s(e)&&n(e.prototype,o(t))}},6244:(t,e,r)=>{var i=r(7466);t.exports=function(t){return i(t.length)}},6339:(t,e,r)=>{var i=r(1702),s=r(7293),n=r(614),a=r(2597),o=r(9781),u=r(6530).CONFIGURABLE,h=r(2788),c=r(9909),l=c.enforce,d=c.get,p=String,f=Object.defineProperty,m=i("".slice),y=i("".replace),g=i([].join),v=o&&!s((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),w=t.exports=function(t,e,r){"Symbol("===m(p(e),0,7)&&(e="["+y(p(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(e="get "+e),r&&r.setter&&(e="set "+e),(!a(t,"name")||u&&t.name!==e)&&(o?f(t,"name",{value:e,configurable:!0}):t.name=e),v&&r&&a(r,"arity")&&t.length!==r.arity&&f(t,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?o&&f(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var i=l(t);return a(i,"source")||(i.source=g(b,"string"==typeof e?e:"")),t};Function.prototype.toString=w((function(){return n(this)&&d(this).source||h(this)}),"toString")},4758:t=>{var e=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(t){var i=+t;return(i>0?r:e)(i)}},3070:(t,e,r)=>{var i=r(9781),s=r(4664),n=r(3353),a=r(9670),o=r(4948),u=TypeError,h=Object.defineProperty,c=Object.getOwnPropertyDescriptor,l="enumerable",d="configurable",p="writable";e.f=i?n?function(t,e,r){if(a(t),e=o(e),a(r),"function"==typeof t&&"prototype"===e&&"value"in r&&p in r&&!r[p]){var i=c(t,e);i&&i[p]&&(t[e]=r.value,r={configurable:d in r?r[d]:i[d],enumerable:l in r?r[l]:i[l],writable:!1})}return h(t,e,r)}:h:function(t,e,r){if(a(t),e=o(e),a(r),s)try{return h(t,e,r)}catch(t){}if("get"in r||"set"in r)throw u("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},1236:(t,e,r)=>{var i=r(9781),s=r(6916),n=r(5296),a=r(9114),o=r(5656),u=r(4948),h=r(2597),c=r(4664),l=Object.getOwnPropertyDescriptor;e.f=i?l:function(t,e){if(t=o(t),e=u(e),c)try{return l(t,e)}catch(t){}if(h(t,e))return a(!s(n.f,t,e),t[e])}},8006:(t,e,r)=>{var i=r(6324),s=r(748).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,s)}},5181:(t,e)=>{e.f=Object.getOwnPropertySymbols},7976:(t,e,r)=>{var i=r(1702);t.exports=i({}.isPrototypeOf)},6324:(t,e,r)=>{var i=r(1702),s=r(2597),n=r(5656),a=r(1318).indexOf,o=r(3501),u=i([].push);t.exports=function(t,e){var r,i=n(t),h=0,c=[];for(r in i)!s(o,r)&&s(i,r)&&u(c,r);for(;e.length>h;)s(i,r=e[h++])&&(~a(c,r)||u(c,r));return c}},5296:(t,e)=>{var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,s=i&&!r.call({1:2},1);e.f=s?function(t){var e=i(this,t);return!!e&&e.enumerable}:r},2140:(t,e,r)=>{var i=r(6916),s=r(614),n=r(111),a=TypeError;t.exports=function(t,e){var r,o;if("string"===e&&s(r=t.toString)&&!n(o=i(r,t)))return o;if(s(r=t.valueOf)&&!n(o=i(r,t)))return o;if("string"!==e&&s(r=t.toString)&&!n(o=i(r,t)))return o;throw a("Can't convert object to primitive value")}},3887:(t,e,r)=>{var i=r(5005),s=r(1702),n=r(8006),a=r(5181),o=r(9670),u=s([].concat);t.exports=i("Reflect","ownKeys")||function(t){var e=n.f(o(t)),r=a.f;return r?u(e,r(t)):e}},4488:(t,e,r)=>{var i=r(8554),s=TypeError;t.exports=function(t){if(i(t))throw s("Can't call method on "+t);return t}},6200:(t,e,r)=>{var i=r(2309),s=r(9711),n=i("keys");t.exports=function(t){return n[t]||(n[t]=s(t))}},5465:(t,e,r)=>{var i=r(7854),s=r(3072),n="__core-js_shared__",a=i[n]||s(n,{});t.exports=a},2309:(t,e,r)=>{var i=r(1913),s=r(5465);(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.32.2",mode:i?"pure":"global",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.2/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:(t,e,r)=>{var i=r(7392),s=r(7293),n=r(7854).String;t.exports=!!Object.getOwnPropertySymbols&&!s((function(){var t=Symbol("symbol detection");return!n(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},1400:(t,e,r)=>{var i=r(9303),s=Math.max,n=Math.min;t.exports=function(t,e){var r=i(t);return r<0?s(r+e,0):n(r,e)}},5656:(t,e,r)=>{var i=r(8361),s=r(4488);t.exports=function(t){return i(s(t))}},9303:(t,e,r)=>{var i=r(4758);t.exports=function(t){var e=+t;return e!=e||0===e?0:i(e)}},7466:(t,e,r)=>{var i=r(9303),s=Math.min;t.exports=function(t){return t>0?s(i(t),9007199254740991):0}},7908:(t,e,r)=>{var i=r(4488),s=Object;t.exports=function(t){return s(i(t))}},7593:(t,e,r)=>{var i=r(6916),s=r(111),n=r(2190),a=r(8173),o=r(2140),u=r(5112),h=TypeError,c=u("toPrimitive");t.exports=function(t,e){if(!s(t)||n(t))return t;var r,u=a(t,c);if(u){if(void 0===e&&(e="default"),r=i(u,t,e),!s(r)||n(r))return r;throw h("Can't convert object to primitive value")}return void 0===e&&(e="number"),o(t,e)}},4948:(t,e,r)=>{var i=r(7593),s=r(2190);t.exports=function(t){var e=i(t,"string");return s(e)?e:e+""}},1694:(t,e,r)=>{var i={};i[r(5112)("toStringTag")]="z",t.exports="[object z]"===String(i)},1340:(t,e,r)=>{var i=r(648),s=String;t.exports=function(t){if("Symbol"===i(t))throw TypeError("Cannot convert a Symbol value to a string");return s(t)}},6330:t=>{var e=String;t.exports=function(t){try{return e(t)}catch(t){return"Object"}}},9711:(t,e,r)=>{var i=r(1702),s=0,n=Math.random(),a=i(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+a(++s+n,36)}},3307:(t,e,r)=>{var i=r(6293);t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:(t,e,r)=>{var i=r(9781),s=r(7293);t.exports=i&&s((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8053:t=>{var e=TypeError;t.exports=function(t,r){if(t<r)throw e("Not enough arguments");return t}},4811:(t,e,r)=>{var i=r(7854),s=r(614),n=i.WeakMap;t.exports=s(n)&&/native code/.test(String(n))},5112:(t,e,r)=>{var i=r(7854),s=r(2309),n=r(2597),a=r(9711),o=r(6293),u=r(3307),h=i.Symbol,c=s("wks"),l=u?h.for||h:h&&h.withoutSetter||a;t.exports=function(t){return n(c,t)||(c[t]=o&&n(h,t)?h[t]:l("Symbol."+t)),c[t]}},7658:(t,e,r)=>{var i=r(2109),s=r(7908),n=r(6244),a=r(3658),o=r(7207);i({target:"Array",proto:!0,arity:1,forced:r(7293)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}}()},{push:function(t){var e=s(this),r=n(e),i=arguments.length;o(r+i);for(var u=0;u<i;u++)e[r]=arguments[u],r++;return a(e,r),r}})},6229:(t,e,r)=>{var i=r(8052),s=r(1702),n=r(1340),a=r(8053),o=URLSearchParams,u=o.prototype,h=s(u.append),c=s(u.delete),l=s(u.forEach),d=s([].push),p=new o("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&i(u,"delete",(function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return c(this,t);var i=[];l(this,(function(t,e){d(i,{key:e,value:t})})),a(e,1);for(var s,o=n(t),u=n(r),p=0,f=0,m=!1,y=i.length;p<y;)s=i[p++],m||s.key===o?(m=!0,c(this,s.key)):f++;for(;f<y;)(s=i[f++]).key===o&&s.value===u||h(this,s.key,s.value)}),{enumerable:!0,unsafe:!0})},7330:(t,e,r)=>{var i=r(8052),s=r(1702),n=r(1340),a=r(8053),o=URLSearchParams,u=o.prototype,h=s(u.getAll),c=s(u.has),l=new o("a=1");!l.has("a",2)&&l.has("a",void 0)||i(u,"has",(function(t){var e=arguments.length,r=e<2?void 0:arguments[1];if(e&&void 0===r)return c(this,t);var i=h(this,t);a(e,1);for(var s=n(r),o=0;o<i.length;)if(i[o++]===s)return!0;return!1}),{enumerable:!0,unsafe:!0})},2062:(t,e,r)=>{var i=r(9781),s=r(1702),n=r(7045),a=URLSearchParams.prototype,o=s(a.forEach);i&&!("size"in a)&&n(a,"size",{get:function(){var t=0;return o(this,(function(){t++})),t},configurable:!0,enumerable:!0})},5355:t=>{t.exports=e},1854:e=>{e.exports=t},6985:t=>{t.exports=r},7793:t=>{t.exports=i}},n={};function a(t){var e=n[t];if(void 0!==e)return e.exports;var r=n[t]={exports:{}};return s[t].call(r.exports,r,r.exports,a),r.exports}a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{a.r(o),a.d(o,{Catalogue:()=>v,Feed:()=>x,default:()=>O,useDraggable:()=>E,useTemplate:()=>S});var t=a(1854),e=a(5355),r=a.n(e);const i=class{constructor(t,e){this.si9n=t,this.configure(e)}configure(t){this.defaults={method:"GET",host:"api.si9n.io",basePath:"/v1",path:"",auth:{},cache:!0,...t}}delete(t,e){return this.call({method:"DELETE",path:t,params:e})}get(t,e){return this.call({method:"GET",path:t,params:e})}patch(t,e){return this.call({method:"PATCH",path:t,params:e})}post(t,e){return this.call({method:"POST",path:t,params:e})}put(t,e){return this.call({method:"PUT",path:t,params:e})}call(t){return new Promise(((e,i)=>{if(!t)return i(new Error("props are required"));const s=t?.auth?.type||"device",n=t?.auth?.org||this.si9n.org.id,a=t?.auth?.id||this.si9n.device.id;if(!n&&"user"!==s)return i(new Error("org required"));if(!a&&"user"!==s)return i(new Error(s+" required"));const o=t.method||this.defaults.method,u=t.host||((this.si9n.device?.app?.name||"").toLowerCase().includes("staging")?"dev-api.si9n.io":"")||this.defaults.host,h=(t.basePath||this.defaults.basePath)+(t.path||this.defaults.path);let c="https://"+u+h;t.params&&!["POST","PUT","PATCH"].includes(o)&&(c+=c.includes("?")?"&":"?",c+=Object.keys(t.params).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t.params[e]))).join("&"));const l=t.auth.key||this.si9n.device.key;if(!l&&"user"!==s)return i(new Error("encryption key is required"));const d=Math.round(3e4*Math.round(Date.now()/3e4)/1e3),p=l&&n+"-"+a+"-"+d+"-"+r()(o+"|"+h.split("?")[0]+"|"+d,l),f={method:o,headers:p&&new Headers({Authorization:s+" "+p}),mode:"cors"};"user"===s&&(f.credentials="include"),t.params&&["POST","PUT","PATCH"].includes(o)&&(f.headers.append("Content-Type","application/json"),f.body=JSON.stringify(t.params));if(("cache"in t?t.cache:this.defaults.cache)&&"GET"===o)return this.si9n.cache.get(new Request(c,f)).then(e).catch(i);fetch(c,f).then((t=>{if(204===t?.status)return e();t.text().then((r=>{let i;try{i=JSON.parse(r)}catch(t){}t.status>=400&&(i={status:t.status,...i}),e(i)}))})).catch(i)}))}};a(6229),a(7330),a(2062),a(7658);const s=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.name=t.name||"si9n-cache",this.blobUrls={}}url(t,e){const r=!Array.isArray(t);return t&&r&&(t=[t]),t&&t.length?caches.open(e||this.name).then((e=>{const i=t.map((t=>{const r=this.key(t);return this.blobUrls[r]?Promise.resolve(this.blobUrls[r]):e.match(t).then((r=>r?r.blob().then((t=>({type:r.headers.get("Content-Type"),blob:t}))):e.add(t).then((()=>e.match(t))).then((t=>t.blob().then((e=>({type:t.headers.get("Content-Type"),blob:e}))))))).then((t=>{let{type:e,blob:i}=t;return!i.type&&e&&(i=i.slice(0,i.size,e)),this.blobUrls[r]=URL.createObjectURL(i),this.blobUrls[r]})).catch((()=>Promise.resolve()))}));return r?i[0]:Promise.all(i)})):Promise.resolve()}get(t,e,r){return t?new Promise(((i,s)=>{const n=r?setTimeout(s,r):null;fetch(t).then((r=>{if(n&&clearTimeout(n),!r.ok)return s();const a=r.clone();caches.open(e||this.name).then((e=>e.put(t,a))),i(this.formatResponse(r))}),s)})).catch((()=>this.has(t,e))):Promise.resolve()}put(t,e,r){if(!t||!e)return Promise.resolve();const i=new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json; charset=utf-8"}});return caches.open(r||this.name).then((e=>e.put(t,i)))}has(t,e){return t?caches.open(e||this.name).then((e=>e.match(t).then((t=>this.formatResponse(t))))):Promise.resolve()}formatResponse(t){if(!t)return Promise.resolve();return 0===(t.headers.get("Content-Type")||"").indexOf("application/json")?t.text().then((t=>{let e;try{e=JSON.parse(t)}catch(t){}return e})):t}key(t){return"object"==typeof t?t.url:t}keys(t){return caches.open(t||this.name).then((t=>t.keys()))}clear(t){t||(t=[this.name]),Array.isArray(t)||(t=[t]);const e=t.map((t=>caches.delete(t)));return e.push(this.clean()),Promise.all(e)}remove(t,e){return t&&!Array.isArray(t)&&(t=[t]),t&&t.length?caches.open(e||this.name).then((e=>{const r=[];return t.forEach((t=>{r.push(e.delete(t)),r.push(this.clean(t))})),Promise.all(r)})):Promise.resolve()}clean(t){return t&&!Array.isArray(t)&&(t=[t]),t||(t=Object.keys(this.blobUrls)),t.forEach((t=>{const e=this.key(t);this.blobUrls[e]&&(URL.revokeObjectURL(this.blobUrls[e]),delete this.blobUrls[e])})),Promise.resolve()}quota(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(((t,e)=>navigator.webkitTemporaryStorage.queryUsageAndQuota(((e,r)=>t({usage:e,quota:r})),e))):Promise.resolve({usage:0,quota:0})}clearIfQuotaLessThan(t,e){return this.quota().then((r=>{let{usage:i,quota:s}=r;return!s||!i||s-i>=t?Promise.resolve(!1):this.clear(e).then((()=>Promise.resolve(!0)))}))}destroy(){this.clean()}};class n extends t.EventEmitter{constructor(t){super(),this.si9n=t,this.locks={},this.channel=new BroadcastChannel("si9n-shared"),this.channel.addEventListener("message",(t=>{if("update"!==t?.data?.type||!t?.data?.key)return;const e=t.data.key,r="update-"+e;this.listenerCount(r)&&this.get(e).then((t=>this.emit(r,t)))}))}get(t){return this.si9n.cache.has(this.globalizeKey(t))}set(t,e){return this.si9n.cache.put(this.globalizeKey(t),e).then((()=>this.notify(t,e)))}remove(t){return this.si9n.cache.remove(this.globalizeKey(t)).then((()=>this.notify(t,null)))}notify(t,e){this.channel.postMessage({type:"update",key:t}),this.emit("update-"+t,e)}globalizeKey(t){return"/"!==t[0]?"/"+t:t}watch(t,e){const r="update-"+t;this.on(r,e),this.get(t).then((t=>this.emit(r,t)));const i=this;return{stop(){i.off(r,e)}}}lock(t){return this.locks[t]?Promise.resolve(!0):new Promise((e=>{navigator.locks.request(t,{ifAvailable:!0},(r=>r?(this.locks[t]=r,e(!0),new Promise((()=>{}))):e(!1)))}))}destroy(){this.removeAllListeners(),this.locks={},this.channel.close(),this.channel=null}}const u=n;class h extends t.EventEmitter{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.window=t.window||window,this.source=null,this.receive=this.receive.bind(this),this.window.addEventListener("message",this.receive),this.window?.si9n?.webview&&(this.window.si9n.webview.listener=this.receive),this.initiated=Date.now(),this.loaded=null,this.notloaded=null,this.disconnected=null,this.started=null,this.paused=null,this.stopped=!0,this.ignoreOnRepeat=!0,this.repeat=!1,this.org={},this.place={},this.device={},this.display={},this.content={},setTimeout((()=>{this.loaded||(this.notloaded=Date.now(),this.emit("notloaded"),this.emit("ready"))}),400)}get api(){return this._api||(this._api=new i(this)),this._api}get cache(){return this._cache||(this._cache=new s),this._cache}get shared(){return this._shared||(this._shared=new u(this)),this._shared}ready(){return new Promise((t=>{if(this.loaded||this.notloaded)return t();this.once("ready",t)}))}receive(t){if(!t?.data?.type||t.data.type.startsWith("webpack"))return;if(this.source&&t.source&&t.source!==this.source)return;const e=t.data;let r=!1;switch(e.type){case"load":this.loaded=Date.now();case"configure":this.source||t.source===this.window||(this.source=t.source),this.configure(e.data),this.emit(e.type,e),"load"===e.type&&this.emit("ready"),r=!0;break;case"message":"data"===e?.data?.type&&e.data.data&&(this.configure({content:{...this.content,data:e.data.data}}),this.emit(e.type,e),r=!0),"disconnect"===e?.data?.type&&(this.disconnected=Date.now()),"connect"===e?.data?.type&&this.disconnected&&(e.data.data={offlineFor:Date.now()-this.disconnected},this.disconnected=null),"display"===e?.data?.type&&e?.data?.data&&this.emit("display",e.data.data),r||(this.emit(e.type,e.data),r=!0);break;case"play":if(this.ignoreOnRepeat&&this.repeat){this.repeat=!1,r=!0;break}if(this.stopped=!1,this.repeat=!1,this.paused){const t=this.paused-this.started;this.started=Date.now()-t,this.paused=0;break}this.started=Date.now();break;case"pause":this.paused=Date.now();break;case"stop":if(this.ignoreOnRepeat&&this.repeat){r=!0;break}if(!e.immediately&&e?.transition?.name&&e.transition.duration){setTimeout((()=>{this.stopped=!0,this.emit("stopped",{type:"stopped"})}),e.transition.duration+32);break}this.stopped=!0,this.emit(e.type,e),this.emit("stopped",{type:"stopped"}),r=!0;break;case"repeat":this.repeat=!0}r||this.emit(e.type,e)}configure(t){if(!t)return;const e=t?.content?.data&&JSON.stringify(t.content.data)!==JSON.stringify(this.content.data);Object.keys(t).forEach((e=>this[e]=t[e])),this.emit("configured",{type:"configured"}),e&&this.content?.template?.fields&&this.emit("data",{type:"data",data:this.content.template.fields.map((t=>({...t,value:this.content.data[t.key]})))})}send(t){this.window?.si9n?.webview?.postMessage?this.window.si9n.webview.postMessage(t):this.source?this.source.postMessage(t,"*"):this.window.parent!==this.window.top&&this.window.parent.postMessage(t,"*"),this.emit("send",t)}get env(){return{previewPlayer:!!this.display.previewPlayer,contentPreview:!!this.display.contentPreview,messageEditing:!!this.display.messageEditing,preview:!!this.display.preview,thumbnail:!!this.display.thumbnail}}get now(){return this.display.now||null}get offline(){return!!this.disconnected&&Date.now()-this.disconnected}get time(){return Date.now()-(this.loaded||this.notloaded)}get elapsed(){return this.stopped?0:this.paused?this.paused-this.started:Date.now()-this.started}get playing(){return this.loaded&&!this.stopped&&!this.paused}end(){this.send({type:"end"})}next(){this.send({type:"next"})}prev(){this.send({type:"prev"})}reset(){this.send({type:"reset"})}printers(){this.send({type:"printers"})}print(t){const e={type:"print",...t&&{data:{printer:t}}};this.send(e)}log(t,e){this.send({type:"log",level:t||"info",data:e})}message(t){this.send({type:"message",data:t})}interrupt(t){this.send({type:"interrupt",data:t})}keepAlive(t){this.send({type:"keepAlive",data:void 0===t||!!t})}skip(t){this.send({type:"skip",data:void 0===t||!!t})}displayMessage(t,e){return new Promise((r=>{this.send({type:"displayMessage",data:t});const i=t=>{t.id&&t.id!==this.display.id||(clearTimeout(s),this.off("display",i),r(t&&t.response))};let s=setTimeout(i,e||1e3);this.on("display",i)}))}serial(t){t?.port&&t?.data?.length&&("string"==typeof t.data&&(t.data=[...(new TextEncoder).encode(t.data)]),this.send({type:"serialMessage",data:t}))}destroy(){this.window.removeEventListener("message",this.receive)}}const c=new h;var l=a(6985);const d=t=>String("00"+t).slice(-2);function p(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t&&e&&e.zone)return l.DateTime.local().setZone(e.zone);if(!t)return l.DateTime.local();let[r,i=""]=t.replace(" ","T").split("T"),[s,n="",a=""]=r.split("-");if(4!==s.length||n.length>2)return l.DateTime.fromISO(t,e);let o=s;if(n.length&&(o+="-"+d(n)),a.length&&(o+="-"+d(a)),i){const r=i.match(/^([0-2]?\d):?([0-5]?\d?):?([0-5]?\d?)(.*)$/);r||l.DateTime.fromISO(t,e),o+="T"+d(r[1]),r[2].length&&(o+=":"+d(r[2])),r[3].length&&(o+=":"+d(r[3])),r[4].length&&(o+=r[4])}return l.DateTime.fromISO(o,e)}var f=a(7793);class m extends t.EventEmitter{constructor(t,e){super(),this.catalogue=t,this.defaults={hoursToLineUp:36},this.data={id:e},this.pricelists=[],this.menus=[],this.timeoutID=null,this.setupTimeoutID=null,this.overrideTimeoutID=null,this.changeTimeoutID=null,this.changeHandler=this.changeHandler.bind(this),this.catalogue.on("change",this.changeHandler),this.offlineHandler=this.offlineHandler.bind(this),c.on("message",this.offlineHandler),c.place?.catalogues?.[this.catalogue.id()]?.scheduleid==e&&(this.placeHandler=this.placeHandler.bind(this),c.on("configured",this.placeHandler)),this.init()}init(){this.watcher&&this.watcher.stop(),this.key="catalogue-schedule-"+this.catalogue.id()+"-"+this.data.id,this.watcher=c.shared.watch(this.key,(t=>{t&&JSON.stringify(t)!==JSON.stringify(this.data)&&(this.data=t,this.setup())})),this.fetch()}changeHandler(t){if(t?.messages?.length){if(t.messages.filter((t=>"Schedule"===t?.model?.type&&t?.model?.id!==this.data.id)).length===t.messages.length)return}this.changeTimeoutID&&clearTimeout(this.changeTimeoutID),this.changeTimeoutID=setTimeout((()=>this.fetch()),Math.floor(1e3*Math.random()*2)+500)}offlineHandler(t){"connect"===t?.type&&t?.data?.offlineFor&&(t.data.offlineFor<6e4||setTimeout(this.changeHandler,Math.floor(1e3*Math.random()*10)))}placeHandler(){if(!this.catalogue)return;const t=c.place?.catalogues?.[this.catalogue.id()]?.scheduleid;this.data.id!==t&&(this.data.id=t,this.init())}at(t){return t&&(this.data.now=t),this}now(){return this.data.now?p(this.data.now,{zone:this.tz()}):c.display.now?p(c.display.now,{zone:this.tz()}):l.DateTime.local().setZone(this.tz())}tz(){return c.place.tz||null}fetch(){return c.shared.lock(this.key).then((t=>{if(t)return Promise.all([this.catalogue.api("/schedules/"+(this.data.id||"default"),{include:"menus",...(this.data.now||c.display.now)&&{date:this.now().toISODate()}}),this.catalogue.overrides({include:"items",...(this.data.now||c.display.now)&&{date:this.now().toISO()}})]).then((t=>c.shared.set(this.key,{now:this.data.now,...this.defaults,...t[0]?.data,overrides:t[1]?.data||[]}))).catch((t=>this.emit("error",t)))}))}setup(){this.setupTimeoutID&&clearTimeout(this.setupTimeoutID),this.setupTimeoutID=setTimeout((()=>this.setup()),60*this.data.hoursToLineUp*60*1e3-3e4);const t=this.now(),e=t.plus({hours:this.data.hoursToLineUp});return this.pricelists=this.itemsForTime((this.data.items||[]).filter((t=>t.active&&t?.pricelist?.id)),t,e),this.menus=this.itemsForTime((this.data.items||[]).filter((t=>t.active&&t?.menu?.id)),t,e,!0),this.resolve()}itemsForTime(t,e,r,i){t=JSON.parse(JSON.stringify(t)),e=e||l.DateTime.local().setZone(this.tz()),r=r||e.plus({days:7}),i=!!i;let s=[];if(t.forEach((t=>{if(t.start=t.start?p(t.start,{zone:this.tz()}):e,t.end&&(t.end=p(t.end,{zone:this.tz()})),t.until&&(t.until=p(t.until,{zone:this.tz()})),"priority"in t||(t.priority=0),!(t.start>r||!t.rrule&&t.end&&t.end<=e))return t.rrule?void this.between(t,e,r).forEach((t=>s.push(t))):s.push(t)})),!s.length)return[];s=s.map(((t,e)=>({...t,idx:e})));const n=(t,e)=>t.start<e.start?-1:t.start>e.start?1:t.priority<e.priority?-1:t.priority>e.priority?1:t.idx<e.idx?-1:t.idx>e.idx?1:0;if(s.sort(n),i)return s;const a=(t,e)=>{if(e.end&&t.start>e.end)return[e];if(t.end&&e.start>t.end)return[e];const r=[];return t.start>e.start&&r.push({...e,end:t.start}),(t.end&&e.end&&t.end<e.end||t.end&&!e.end)&&r.push({...e,start:t.end}),r},o=[];let u=0;for(;u<s.length;){const t=s.length;for(let e=u+1;e<t;e++){const t=s[u],r=a(s[e],t);if(!r.length){const t=s.splice(u,1);o.push(t[0]),u--;break}s[u]=r[0],r.length>1&&s.splice(u+1,0,r[1])}u++}return s=s.map(((t,e)=>({...t,idx:e}))),s.sort(n),o.length?o.concat(s):s}between(t,e,r){const i="yyyyMMdd'T'HHmmss";let s=p(e.toFormat(i),{zone:"utc"});const n=p(r.toFormat(i),{zone:"utc"}),a=p(t.start.toFormat(i),{zone:"utc"}),o=t.end?p(t.end.toFormat(i),{zone:"utc"}):null,u=o?o.diff(a,"seconds").seconds:0;a<s&&(s=s.minus({seconds:u}));let h=t.rrule+";DTSTART="+a.toFormat(i)+"Z";t.until&&(h+=";UNTIL="+t.until.toFormat(i)+"Z");return f.RRule.fromString(h).between(s.toJSDate(),n.toJSDate(),!0).map((e=>{const r={start:p(e.getUTCFullYear()+"-"+(e.getUTCMonth()+1)+"-"+e.getUTCDate()+"T"+e.getUTCHours()+":"+e.getUTCMinutes()+":"+e.getUTCSeconds(),{zone:this.tz()})};if(t.end){const t=new Date(e.getTime()+1e3*u);r.end=p(t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+"T"+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds(),{zone:this.tz()})}return{...t,...r}}))}resolve(){this.nextResolve();const t=this.now(),e=this.pricelists.filter((e=>e.start<=t&&(!e.end||e.end>t))).shift(),r=e?e.pricelist.id:null,i=this.menus.filter((e=>e.start<=t&&(!e.end||e.end>t)));let s=(this.data.overrides||[]).filter((e=>!e.end||p(e.end)>t));const n=s.reduce(((t,e)=>{if(!e.end)return t;const r=p(e.end);return(!t||r<t)&&(t=r),t}),!1);this.overrideTimeoutID&&clearTimeout(this.overrideTimeoutID),n&&(this.overrideTimeoutID=setTimeout((()=>this.resolve()),n.diff(t).milliseconds)),s=s.reduce(((t,e)=>{t[e.entity]||(t[e.entity]={}),t[e.entity][e.entityid]||(t[e.entity][e.entityid]={});const r={start:e.start};return e.end&&(r.end=e.end),e.attribs&&(r.attribs={...t[e.entity][e.entityid].attribs,...e.attribs}),e.replacement&&(r.replacement=e.replacement),t[e.entity][e.entityid]={...t[e.entity][e.entityid],...r},t}),{}),(this.data.menus||[]).forEach((t=>{const e=JSON.parse(JSON.stringify(t));if(e.id&&s?.Menu?.[e.id]?.attribs&&(e.attribs={...e.attribs,...s.Menu[e.id].attribs}),e?.items?.length&&e.items.forEach((t=>{let e;if(s?.MenuItem?.[t.id]?.attribs&&(t.attribs={...t.attribs,...s.MenuItem[t.id].attribs}),s?.Item?.[t?.item?.id]?.replacement&&(e=s.Item?.[t.item.id].replacement),s?.MenuItem?.[t?.id]?.replacement&&(e=s.MenuItem?.[t.id].replacement),e&&(t.item&&(t.replaces=t.item),t.item=e),!t.item)return;const r=t.item;if(s?.Item?.[r.id]?.attribs&&(r.attribs={...r.attribs,...s.Item[r.id].attribs}),s?.Type?.[r?.type?.id]?.attribs&&(r.type.attribs={...r.type.attribs,...s.Type[r.type.id].attribs}),s?.Brand?.[r?.brand?.id]?.attribs&&(r.brand.attribs={...r.brand.attribs,...s.Brand[r.brand.id].attribs}),r.variants&&r.variants.forEach((t=>{s?.ItemVariant?.[t.id]?.attribs&&(t.attribs={...t.attribs,...s.ItemVariant[t.id].attribs}),t.modifiers&&t.modifiers.forEach((t=>{s?.ItemVariantModifier?.[t.id]&&(t.attribs={...t.attribs,...s.ItemVariantModifier[t.id].attribs})}))})),!r.replaces)return;const i=r.replaces;s?.Item?.[i.id]?.attribs&&(i.attribs={...i.attribs,...s.Item[i.id].attribs}),s?.Type?.[i?.type?.id]?.attribs&&(i.type.attribs={...i.type.attribs,...s.Type[i.type.id].attribs}),s?.Brand?.[i?.brand?.id]?.attribs&&(i.brand.attribs={...i.brand.attribs,...s.Brand[i.brand.id].attribs}),i.variants&&i.variants.forEach((t=>{s?.ItemVariant?.[t.id]?.attribs&&(t.attribs={...t.attribs,...s.ItemVariant[t.id].attribs}),t.modifiers&&t.modifiers.forEach((t=>{s?.ItemVariantModifier?.[t.id]?.attribs&&(t.attribs={...t.attribs,...s.ItemVariantModifier[t.id].attribs})}))}))})),e?.items?.length){const t=(t,e)=>{const r=t.filter((t=>!e&&t.default||t.listid===e));return r.length?r:t.filter((t=>t.default))};e.items.forEach((e=>{e?.item?.variants?.length&&(e.item.variants.forEach((e=>{e?.prices?.length&&(e.prices=t(e.prices,r),e.prices.length||delete e.prices)})),e.replaces&&e.replaces.variants.forEach((e=>{e?.prices?.length&&(e.prices=t(e.prices,r),e.prices.length||delete e.prices)})),e.item.variants.filter((t=>!!t.modifiers)).forEach((e=>{e.modifiers.filter((t=>!!t.variants)).forEach((e=>{e.variants.forEach((e=>{e?.prices?.length&&(e.prices=t(e.prices,r),e.prices.length||delete e.prices)}))}))})))}))}i.filter((t=>t.menu.id===e.id)).forEach((t=>t.menu=e))})),setTimeout((()=>this.emit("slots",i)),0)}nextResolve(){const t=this.now();let e=null;this.pricelists.filter((e=>e.start>t)).forEach((t=>{(!e||e>t.start)&&(e=t.start)})),this.menus.filter((e=>e.start>t)).forEach((t=>{(!e||e>t.start)&&(e=t.start)})),this.pricelists.filter((e=>e.start<=t&&e.end>t)).forEach((t=>{(!e||e>t.end)&&(e=t.end)})),this.menus.filter((e=>e.start<=t&&e.end>t)).forEach((t=>{(!e||e>t.end)&&(e=t.end)})),this.timeoutID&&clearTimeout(this.timeoutID),e&&(this.timeoutID=setTimeout((()=>this.resolve()),e.diff(t).milliseconds))}destroy(){this.timeoutID&&clearTimeout(this.timeoutID),this.setupTimeoutID&&clearTimeout(this.setupTimeoutID),this.overrideTimeoutID&&clearTimeout(this.overrideTimeoutID),this.changeTimeoutID&&clearTimeout(this.changeTimeoutID),this.removeAllListeners(),c.off("configured",this.placeHandler),c.off("message",this.offlineHandler),this.catalogue&&this.catalogue.off("change",this.changeHandler),this.catalogue=null,this.data={},this.pricelists=[],this.menus=[],this.key=null,this.watcher.stop()}}const y=m;class g extends t.EventEmitter{constructor(t){super(),this.configure(t),this.messageHandler=this.messageHandler.bind(this),c.on("message",this.messageHandler)}configure(t){this.cnf={id:"",host:"",path:"",auth:{},...t},this.cnf.id&&!this.cnf.path&&(this.cnf.path="/v1/catalogues/"+this.cnf.id),this.cnf.auth.key||c.device.key||(this.cnf.auth.type="user")}messageHandler(t){"catalogue"===t?.type&&t?.data?.id===this.cnf.id&&this.emit("change",t.data)}api(t,e){return this.cnf.path?c.api.call({host:this.cnf.host,basePath:this.cnf.path,auth:this.cnf.auth,path:t,params:e}):Promise.reject(new Error("path is required"))}id(){return this.cnf.id}brands(t){return this.api("/brands",t)}brand(t,e){return this.api("/brands/"+t,e)}types(t){return this.api("/types",t)}type(t,e){return this.api("/types/"+t,e)}categories(t){return this.api("/categories",t)}category(t,e){return this.api("/categories/"+t,e)}items(t){return this.api("/items",t)}item(t,e){return this.api("/items/"+t,e)}itemTags(){return this.api("/items/tags")}pricelists(t){return this.api("/pricelists",t)}pricelist(t,e){return this.api("/pricelists/"+(t||"default"),e)}currencies(){return this.api("/currencies")}attributes(t){return this.api("/attributes",t)}attribute(t,e){return this.api("/attributes/"+t,e)}menus(t){return this.api("/menus",t)}menu(t,e){return this.api("/menus/"+t,e)}schedules(t){return this.api("/schedules",t)}scheduledItems(t,e){return this.api("/schedules/"+t+"/items",e)}schedule(t){return!t&&c.place?.catalogues?.[this.id()]&&(t=c.place.catalogues[this.id()].scheduleid),new y(this,t||"default")}overrides(t){return c.place.overrides?this.api("/overrides",t):Promise.resolve()}destroy(){c.off("message",this.messageHandler),this.removeAllListeners()}static list(){const t=[];return c.place.inventory&&c.place.inventory.filter((t=>"Catalogue"===t.type)).forEach((e=>t.push(e))),c.content?.data&&Object.keys(c.content.data).forEach((e=>{"Catalogue"===c.content?.data?.[e]?.type&&t.push(c.content.data[e])})),t}static use(t){if(!t||"string"==typeof t){const e=g.list();e.length&&(t=t?e.find((e=>e.id===t)):e[0])}return new g(t)}}const v=g;class b extends t.EventEmitter{constructor(t,e){super(),this.feed=t,this.params=e||{active:!0,limit:"all"},this.data={},this.items=[],this.timeoutID=null,this.changeTimeoutID=null,this.changeHandler=this.changeHandler.bind(this),this.feed.on("change",this.changeHandler),this.offlineHandler=this.offlineHandler.bind(this),c.on("message",this.offlineHandler),this.key="feed-"+this.feed.id()+"-"+Object.keys(this.params).map((t=>t+"-"+this.params[t])).join("-"),this.watcher=c.shared.watch(this.key,(t=>this.update(t))),this.fetch()}changeHandler(){this.changeTimeoutID&&clearTimeout(this.changeTimeoutID),this.changeTimeoutID=setTimeout((()=>this.fetch()),Math.floor(1e3*Math.random()*2)+500)}offlineHandler(t){"connect"===t?.type&&t?.data?.offlineFor&&(t.data.offlineFor<3e4||setTimeout(this.changeHandler,Math.floor(1e3*Math.random()*10)))}at(t){return t&&(this.data.now=t),this}now(){return this.data.now?p(this.data.now,{zone:this.tz()}):c.display.now?p(c.display.now,{zone:this.tz()}):l.DateTime.local().setZone(this.tz())}tz(){return c.place.tz||null}fetch(){return c.shared.lock(this.key).then((t=>{if(!t)return;const e={...this.params};return(this.data.now||c.display.now)&&(e.date=this.now().toISODate()),e.date||(e.now=!0),e.include||(e.include="kind"),this.feed.api("/items",e).then((t=>{if(t?.status>=400)return;const e=t?.data||[];return JSON.stringify(e)!==JSON.stringify(this.items)?c.shared.set(this.key,e):void 0})).catch((t=>this.emit("error",t)))}))}update(t){t&&(this.items=t);const e=this.now(),r=this.items.filter((t=>!("news"===t.kind&&p(t.start)>e)&&!("events"===t.kind&&t.end&&p(t.end)<=e)));setTimeout((()=>this.emit("items",r)),0),this.refresh()}refresh(){this.timeoutID&&clearTimeout(this.timeoutID);const t=this.items?.[0]?.kind;if(!t)return;let e=0;if("news"===t&&(e=l.DateTime.local().plus({days:1}).startOf("day").toMillis()-Date.now()),"events"===t){const t=this.items.filter((t=>t.end&&p(t.end).toMillis()>Date.now())).map((t=>p(t.end).toMillis()));t.length&&(e=Math.min(...t)-Date.now())}e>0&&(this.timeoutID=setTimeout((()=>this.update()),e))}destroy(){this.timeoutID&&clearTimeout(this.timeoutID),this.changeTimeoutID&&clearTimeout(this.changeTimeoutID),this.removeAllListeners(),c.off("message",this.offlineHandler),this.feed&&this.feed.off("change",this.changeHandler),this.feed=null,this.params=null,this.data={},this.items=[],this.key=null,this.watcher.stop()}}const w=b;class T extends t.EventEmitter{constructor(t){super(),this.configure(t),this.messageHandler=this.messageHandler.bind(this),c.on("message",this.messageHandler)}configure(t){this.cnf={id:"",host:"",path:"",auth:{},...t},this.cnf.id&&!this.cnf.path&&(this.cnf.path="/v1/feeds/"+this.cnf.id),this.cnf.auth.key||c.device.key||(this.cnf.auth.type="user")}messageHandler(t){"feed"===t?.type&&t?.data?.id===this.cnf.id&&this.emit("change",t.data)}api(t,e){return this.cnf.path?c.api.call({host:this.cnf.host,basePath:this.cnf.path,auth:this.cnf.auth,path:t,params:e}):Promise.reject(new Error("path is required"))}id(){return this.cnf.id}items(t){return this.api("/items",t)}item(t,e){return this.api("/items/"+t,e)}itemTags(){return this.api("/items/tags")}attributes(t){return this.api("/attributes",t)}attribute(t,e){return this.api("/attributes/"+t,e)}watch(t){return new w(this,t)}destroy(){c.off("message",this.messageHandler),this.removeAllListeners()}static list(){const t=[];return c.place.inventory&&c.place.inventory.filter((t=>"Feed"===t.type)).forEach((e=>t.push(e))),c.content?.data&&Object.keys(c.content.data).forEach((e=>{"Feed"===c.content?.data?.[e]?.type&&t.push(c.content.data[e])})),t}static use(t){if(!t||"string"==typeof t){const e=T.list();e.length&&(t=t?e.find((e=>e.id===t)):e[0])}return new T(t)}}const x=T;function E(t){t.classList.add("draggable"),t.style.cursor="grab",t.style.userSelect="none";const e={x:0,y:0,w:null,h:null},r=r=>{r&&(Object.keys(r).forEach((t=>e[t]=r[t])),t.style.transform=e.x||e.y?"translate("+e.x+"px, "+e.y+"px)":"",t.style.width=e.w?e.w+"px":"",t.style.height=e.h?e.h+"px":"")},i=i=>{t.classList.add("dragging"),t.style.cursor="grabbing";const s="touchstart"===i.type?i.touches[0].clientX:i.x,n="touchstart"===i.type?i.touches[0].clientY:i.y,a=t.getBoundingClientRect(),o=s-e.x,u=n-e.y,h=Math.round(a.width),c=Math.round(a.height),l=Math.round(s-a.x),d=Math.round(n-a.y),p=l>h-18&&d>c-18;p&&(t.classList.add("resizing"),t.style.cursor="nwse-resize");const f=t=>{const i="touchmove"===t.type?t.touches[0].clientX:t.x,s="touchmove"===t.type?t.touches[0].clientY:t.y;r(p?{w:h+i-o-e.x,h:c+s-u-e.y}:{x:i-o,y:s-u})},m=()=>{t.classList.remove("dragging"),t.classList.remove("resizing"),t.style.cursor="grab",window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",m),t.dispatchEvent(new CustomEvent("change",{bubbles:!0,detail:e}))};window.addEventListener("mousemove",f),window.addEventListener("mouseup",m),window.addEventListener("touchmove",f),window.addEventListener("touchend",m)};return t.addEventListener("mousedown",i),t.addEventListener("touchstart",i),t.addEventListener("dblclick",(()=>r({x:0,y:0,w:null,h:null}))),[e,r]}let k;function S(){if(k)return k;k=new t.EventEmitter,c.once("ready",(()=>{setTimeout((()=>document.documentElement.classList.add("loaded")),32),c.env.messageEditing&&(document.documentElement.classList.add("editing"),document.querySelector("[data-layout]")&&c.send({type:"interactive"}))})),c.on("play",(()=>{document.querySelectorAll("[data-video]").forEach((t=>{t.currentTime=0,t.play()})),document.documentElement.classList.add("play"),document.documentElement.classList.remove("stop")})),c.on("stop",(()=>{document.documentElement.classList.add("stop")})),c.on("stopped",(()=>{setTimeout((()=>{c.playing||(document.documentElement.classList.remove("play","stop"),document.querySelectorAll("[data-video]").forEach((t=>{t.currentTime=0,t.pause()})))}),16)})),c.on("data",(t=>e(t.data)));const e=t=>{(t||[]).forEach((t=>{const e=document.querySelector('[data-field="'+t.key+'"]')||document.querySelector('[data-image="'+t.key+'"]')||document.querySelector('[data-paragraphs="'+t.key+'"]')||document.querySelector('[data-html="'+t.key+'"]')||document.querySelector('[data-cssvar="'+t.key+'"]')||document.querySelector('[data-layout="'+t.key+'"]');if(k.listenerCount("field-"+t.key))return k.emit("field-"+t.key,t,e,c);if(e)switch(t.type){case"json":break;case"bool":t.value?e.classList.add(t.key):e.classList.remove(t.key);break;case"content":{let r=t.value?.checksum?"../"+t.value.checksum:null;if(r&&c.env.preview&&t.value?.preview?.url&&(r=t.value.preview.url),!r&&"string"==typeof t.value&&t.value&&(r=t.value),!r&&e.hasAttribute("data-default")&&(r=e.getAttribute("data-default")),e.hasAttribute("data-image")&&e.getAttribute("data-image")===t.key){e.style.backgroundImage=r?"url("+r+")":"";break}const i=e.firstChild;if(i&&r&&i.getAttribute("data-url")===r)break;if(i&&i.remove(),r){let i=null;"Video"===t.value?.type?(i=document.createElement("video"),i.preload="auto",i.muted=!0,i.loop=!0,i.setAttribute("data-video",""),c.playing&&(i.autoplay=!0)):i=document.createElement("img"),i.setAttribute("data-url",r),i.src=r,e.appendChild(i)}break}case"textarea":if(e.hasAttribute("data-html")&&e.getAttribute("data-html")===t.key){e.innerHTML=t.value;break}if(e.hasAttribute("data-paragraphs")&&e.getAttribute("data-paragraphs")===t.key){e.innerHTML=i(t.value).map((t=>"<p>"+r(t)+"</p>")).join("");break}default:if(e.hasAttribute("data-cssvar")&&e.getAttribute("data-cssvar")===t.key){t.value?e.style.setProperty("--"+t.key,t.value):e.style.removeProperty("--"+t.key);break}e.textContent=t.value||""}}))};document.querySelectorAll("[data-layout]").forEach((t=>{const e=t.getAttribute("data-layout"),[r,i]=E(t);k.on("field-"+e,(t=>i(t.value))),t.addEventListener("change",(()=>c.send({type:"preview",data:{fields:{[e]:r}}})))}));const r=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return(t||"").replace(/[&<>"']/g,(t=>e[t]))},i=t=>(t||"").trim().split(/\n\s*\n/g).map((t=>t.trim())).filter((t=>!!t)),s=t=>fetch(t).then((t=>t.json())).then((t=>fetch(t["_si9n.json"]||"si9n.json").then((t=>t.json())).then((e=>{c.receive({data:{type:"configure",data:{content:{...e,data:t}}}})}))));if(0===location.search.indexOf("?test")){document.documentElement.classList.add("testing");let t=location.search.substr(1).split("&")[0].split(".")[0];-1===t.indexOf(".json")&&(t+=".json"),s(t).then((()=>{setTimeout((()=>c.receive({data:{type:"play"}})),128)}))}return c.once("configured",(t=>{c.env.thumbnail&&(t?.data?.content?.data||s("thumb.json").catch((()=>{})))})),k.render=e,k.e=r,k.lines=t=>(t||"").split(/[\r\n]+/).map((t=>t.trim())).filter((t=>!!t)),k.paragraphs=i,k}const O=c})(),o})()));